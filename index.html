<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ØªØ¹ÛŒÛŒÙ† Ú¯Ø±ÙˆÙ‡ Ø±Ù†Ú¯ÛŒ Ù…ÙˆØ§Ø¯ ØºØ°Ø§ÛŒÛŒ</title>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: Tahoma, sans-serif;
      background-color: #f9f9f9;
      direction: rtl;
      padding: 10px;
      position: relative;
    }
    header {
      background: #3D8632;
      color: #fff;
      padding: 2px;
      border-radius: 2px;
      text-align: center;
      margin-bottom: 5px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 500px;
      margin: 0 auto 20px;
      background-color: #fff;
    }
    th, td {
      border: 1px solid #5300AD;
      padding: 2px 3px;
      text-align: center;
      font-size: 14px;
    }
    th {
      background-color: #BEB567;
    }
    input, select {
      width: 100%;
      padding: 6px;
      font-size: 15px;
      margin: 4px 0;
      box-sizing: border-box;
      text-align: center;
      font-weight: bold;
      line-height: 1.6;
      height: 36px;
    }
    .green {
      background-color: #7AB52A;
      color: #256029;
    }
    .orange {
      background-color: #FFCC00;
      color: #000;
    }
    .red {
      background-color: #E00815;
      color: #FFF;
    }
    .float-container {
      position: fixed;
      bottom: 30px;
      right: 20px;
      display: flex;
      flex-direction: column-reverse;
      gap: 8px;
      z-index: 100;
    }
    .float-btn {
      background-color: #2563EB;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .float-btn:hover {
      background-color: #1E40AF;
    }
    @media print {
      body * { visibility: hidden; }
      #exportArea, #exportArea * { visibility: visible; }
      #exportArea { position: absolute; top: 0; left: 0; width: 100%; }
      table, th, td {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
    }
    #welcomeOverlay, #helpOverlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
    }
    #welcomeOverlay {
      background: linear-gradient(115deg, #2163EB, #2CA7EC);
    }
    #welcomeOverlay .box {
      background: #fff;
      padding: 50px;
      border-radius: 10px;
      text-align: center;
      max-width: 600px;
      animation: fadeInOut 5s forwards;
    }
    #welcomeOverlay .box h1 {
      margin-bottom: 10px;
      font-family: 'Dancing Script', cursive;
      font-size: 22px;
      color: #000;
      line-height: 1.3;
    }
    #welcomeOverlay .author {
      font-size: 18px;
      margin-bottom: 15px;
    }
    #welcomeOverlay .spinner {
      margin: 0 auto 15px;
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #2563EB;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    #welcomeOverlay .copyright {
      font-size: 14px;
      color: #666;
      margin-top: 10px;
    }
    @keyframes spin { 0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); } }
    @keyframes fadeInOut {
      0% { opacity:0; } 10% { opacity:1; } 90% { opacity:1; } 100% { opacity:0; visibility:hidden; }
    }
    #helpOverlay {
      background: rgba(0,0,0,0.6);
      display: none;
    }
    #helpOverlay .box {
      background: #fff;
      padding: 20px;
      border-radius: 6px;
      max-width: 500px;
      text-align: right;
      line-height: 1.6;
      position: relative;
    }
    #helpOverlay .close-btn {
      position: absolute;
      top: 8px; left: 8px;
      background: #e53e3e;
      border: none;
      color: #fff;
      border-radius: 50%;
      width: 28px; height: 28px;
      font-size: 18px;
      cursor: pointer;
    }
    #helpOverlay h2 {
      margin-top: 0;
      font-size: 20px;
      text-align: center;
    }
    #helpOverlay ol {
      padding-right: 16px;
    }
    #helpOverlay ol li {
      margin-bottom: 8px;
    }
    #helpOverlay .contact {
      margin-top: 12px;
      font-size: 14px;
    }
    #helpOverlay .contact strong {
      display: block;
      margin-bottom: 4px;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>

  <header>
    <h2>Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± ØªØ¹ÛŒÛŒÙ† Ú¯Ø±ÙˆÙ‡ Ø±Ù†Ú¯ÛŒ Ù…ÙˆØ§Ø¯ ØºØ°Ø§ÛŒÛŒ (Ù†Ø´Ø§Ù†Ú¯Ø± Ø±Ù†Ú¯ÛŒ) v1.1</h2>
  </header>

  <!-- Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ -->
  <div id="welcomeOverlay">
    <div class="box">
      <img src="https://www.1and1group.com/wp-content/uploads/2024/06/1and1group-logo.webp"
           alt="Logo" style="width:120px; border-radius:12px; margin-bottom:15px;">
      <h1>Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± ØªØ¹ÛŒÛŒÙ† Ú¯Ø±ÙˆÙ‡ Ø±Ù†Ú¯ÛŒ Ù…ÙˆØ§Ø¯ ØºØ°Ø§ÛŒÛŒ<br>Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¢Ø®Ø±ÛŒÙ† ÙˆÛŒØ±Ø§ÛŒØ´ Ø¶ÙˆØ§Ø¨Ø· Ø³Ø§Ø²Ù…Ø§Ù† ØºØ°Ø§ Ùˆ Ø¯Ø§Ø±Ùˆ</h1>
      <div class="author">Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡: Ù…ØµÛŒØ¨ Ø®Ø§Ù†ÛŒ â€“ Ú©Ø§Ø±Ø´Ù†Ø§Ø³ Ø¢Ø²Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ Ùˆ Ú©Ù†ØªØ±Ù„ Ú©ÛŒÙÛŒØª</div>
      <div class="spinner"></div>
      <div class="copyright">
        Â© 2025 Ø¢Ø²Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ Ùˆ Ú©Ù†ØªØ±Ù„ Ú©ÛŒÙÛŒØª ÙØ±Ø§ÙˆØ±Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØºØ°Ø§ÛŒÛŒ Ø¯Ø´Øª Ù…Ø±ØºØ§â€ŒØ¨ (ÛŒÚ© Ùˆ ÛŒÚ©). All rights reserved.
      </div>
    </div>
  </div>

  <!-- ÙØ±Ù… ÙˆØ±ÙˆØ¯ÛŒ -->
  <table>
    <tr>
      <th>Ù†Ø§Ù… Ù…Ø§Ø¯Ù‡ ØºØ°Ø§ÛŒÛŒ</th>
      <td><input type="text" id="foodName" oninput="render()"></td>
    </tr>
    <tr>
      <th>Ù†ÙˆØ¹ Ù…Ø§Ø¯Ù‡ ØºØ°Ø§ÛŒÛŒ</th>
      <td>
        <select id="foodType" onchange="updateServingUnits(); render()">
          <option value="Ø¬Ø§Ù…Ø¯">Ø¬Ø§Ù…Ø¯</option>
          <option value="Ù…Ø§ÛŒØ¹">Ù…Ø§ÛŒØ¹</option>
        </select>
      </td>
    </tr>
    <tr>
      <th>Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø³Ù‡Ù…</th>
      <td><input type="number" id="servingSize" oninput="render()"></td>
    </tr>
    <tr>
      <th>ÙˆØ§Ø­Ø¯ Ø³Ù‡Ù…</th>
      <td><select id="servingUnit" onchange="render()"></select></td>
    </tr>
    <tr>
      <th>Ù…Ø¹ÛŒØ§Ø± Ø³Ù‡Ù…</th>
      <td>
        <input type="text" id="servingCriterion" list="servingList"
               placeholder="Ø¬Ø³ØªØ¬Ùˆ ÛŒØ§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" oninput="render()">
        <datalist id="servingList">
          <option value="1 Ù‚Ø§Ø´Ù‚ Ú†Ø§ÛŒØ®ÙˆØ±ÛŒ">
          <option value="1 Ù‚Ø§Ø´Ù‚ ØºØ°Ø§Ø®ÙˆØ±ÛŒ">
          <option value="2 Ù‚Ø§Ø´Ù‚ ØºØ°Ø§Ø®ÙˆØ±ÛŒ">
          <option value="1 Ù‚Ø§Ø´Ù‚ Ù…Ø±Ø¨Ø§Ø®ÙˆØ±ÛŒ">
          <option value="2 Ù‚Ø§Ø´Ù‚ Ù…Ø±Ø¨Ø§Ø®ÙˆØ±ÛŒ">
          <option value="1 ÙÙ†Ø¬Ø§Ù†">
          <option value="1/2 ÙÙ†Ø¬Ø§Ù†">
          <option value="1/2 Ø¹Ø¯Ø¯">
          <option value="1 Ø¹Ø¯Ø¯">
          <option value="2 Ø¹Ø¯Ø¯">
          <option value="3 Ø¹Ø¯Ø¯">
          <option value="5 Ø¹Ø¯Ø¯">
          <option value="7 Ø¹Ø¯Ø¯">
          <option value="5 ØªÚ©Ù‡">
          <option value="10 Ø§Ø³Ù„Ø§ÛŒØ³">
          <option value="11 Ø§Ø³Ù„Ø§ÛŒØ³">
          <option value="12 Ø§Ø³Ù„Ø§ÛŒØ³">
          <option value="13 Ø§Ø³Ù„Ø§ÛŒØ³">
        </datalist>
      </td>
    </tr>
    <tr>
      <th>Ø§Ù†Ø±Ú˜ÛŒ Ø¯Ø± 100 Ú¯Ø±Ù…</th>
      <td><input type="number" id="energy100" oninput="render()"></td>
    </tr>
    <tr>
      <th>Ù‚Ù†Ø¯ Ø¯Ø± 100 Ú¯Ø±Ù…</th>
      <td><input type="number" id="sugar100" oninput="render()"></td>
    </tr>
    <tr>
      <th>Ú†Ø±Ø¨ÛŒ Ø¯Ø± 100 Ú¯Ø±Ù…</th>
      <td><input type="number" id="fat100" oninput="render()"></td>
    </tr>
    <tr>
      <th>Ù†Ù…Ú© Ø¯Ø± 100 Ú¯Ø±Ù…</th>
      <td><input type="number" id="salt100" oninput="render()"></td>
    </tr>
    <tr>
      <th>Ø§Ø³ÛŒØ¯Ú†Ø±Ø¨ ØªØ±Ø§Ù†Ø³ Ø¯Ø± 100 Ú¯Ø±Ù…</th>
      <td><input type="number" id="trans100" oninput="render()"></td>
    </tr>
  </table>

  <!-- Ø®Ø±ÙˆØ¬ÛŒ -->
  <div id="exportArea"><div id="resultContainer"></div></div>

  <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ù†Ø§ÙˆØ± -->
  <div class="float-container">
    <button class="float-btn" title="Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡" onclick="toggleHelp()">â”</button>
    <button class="float-btn" title="Ø±ÛŒØ³Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§" onclick="clearInputs()">ğŸ”„</button>
    <button class="float-btn" title="Ø°Ø®ÛŒØ±Ù‡ Excel" onclick="exportExcel()">ğŸ“Š</button>
    <button class="float-btn" title="Ù¾Ø±ÛŒÙ†Øª Ø¬Ø¯ÙˆÙ„" onclick="printTable()">ğŸ–¨ï¸</button>
    <button class="float-btn" title="Ø°Ø®ÛŒØ±Ù‡ ØªØµÙˆÛŒØ±" onclick="saveAsPNG()">ğŸ’¾</button>
  </div>

  <script>
    const rules = {
      Ø¬Ø§Ù…Ø¯: { fat:[3,17.5,21], sugar:[5,22.5,27], salt:[0.3,1.5,1.8], trans:[0.5,2,2] },
      Ù…Ø§ÛŒØ¹: { fat:[1.5,8.75,10.5], sugar:[2.5,11.25,13.5], salt:[0.3,0.75,0.9], trans:[0.5,2,2] }
    };
    const translations = { 'Ø§Ù†Ø±Ú˜ÛŒ':'Energy','Ù‚Ù†Ø¯':'Sugar','Ú†Ø±Ø¨ÛŒ':'Fat','Ù†Ù…Ú©':'Salt','Ø§Ø³ÛŒØ¯Ú†Ø±Ø¨ ØªØ±Ø§Ù†Ø³':'TFA' };

    function updateServingUnits(){
      const type = document.getElementById("foodType").value;
      const sel  = document.getElementById("servingUnit");
      sel.innerHTML="";
      const units = type==="Ø¬Ø§Ù…Ø¯"?["Ú¯Ø±Ù…"]:["Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±"];
      units.forEach(u=>{const o=document.createElement("option");o.value=u;o.textContent=u;sel.appendChild(o);});
    }

    function getColor(amount, size, [g,o,m]){
      const type=document.getElementById("foodType").value;
      const baseLimit=type==="Ù…Ø§ÛŒØ¹"?150:100;
      const v=parseFloat(amount), s=parseFloat(size);
      if(isNaN(v))return"";
      if(s>baseLimit){
        if(v<=g)return"green";
        if(v>g&&v<=m)return"orange";
        return"red";
      }
      if(v<=g)return"green";
      if(v>g&&v<=o)return"orange";
      return"red";
    }

    function render(){
      const name=document.getElementById("foodName").value.trim();
      const size=+document.getElementById("servingSize").value||0;
      if(!name||size<=0){document.getElementById("resultContainer").innerHTML="";return;}
      const type=document.getElementById("foodType").value;
      const unit=document.getElementById("servingUnit").value;
      const crit=document.getElementById("servingCriterion").value;
      const e100str=document.getElementById("energy100").value;
      const s100str=document.getElementById("sugar100").value;
      const f100str=document.getElementById("fat100").value;
      const sa100str=document.getElementById("salt100").value;
      const t100str=document.getElementById("trans100").value;

      const rawEnergy=e100str!==""?(+e100str*size/100):NaN;
      const rawSugar =s100str!==""?(+s100str*size/100):NaN;
      const rawFat   =f100str!==""?(+f100str*size/100):NaN;
      const rawSalt  =sa100str!==""?(+sa100str*size/100):NaN;
      const rawTrans =t100str!==""?(+t100str*size/100):NaN;

      const raws=[rawEnergy,rawSugar,rawFat,rawSalt,rawTrans];
      // Ù†Ù…Ø§ÛŒØ´ ØªØ§ Û³ Ø±Ù‚Ù… Ø§Ø¹Ø´Ø§Ø±
      const vals=raws.map(v=>isNaN(v)?"":v.toFixed(3));

      const classes=[
        "",
        !isNaN(raws[1])?getColor(raws[1],size,rules[type].sugar):"",
        !isNaN(raws[2])?getColor(raws[2],size,rules[type].fat):"",
        !isNaN(raws[3])?getColor(raws[3],size,rules[type].salt):"",
        !isNaN(raws[4])?getColor(raws[4],size,rules[type].trans):""
      ];

      const shareLabel=crit?`${crit} ${name} â€“ ${size} ${unit}`:`${name} â€“ ${size} ${unit}`;

      let html=`<table><tr><th>Ù…Ø§Ø¯Ù‡ Ù…ØºØ°ÛŒ / Nutrient</th><th>Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø³Ù‡Ù… (${shareLabel})</th></tr>`;
      ['Ø§Ù†Ø±Ú˜ÛŒ','Ù‚Ù†Ø¯','Ú†Ø±Ø¨ÛŒ','Ù†Ù…Ú©','Ø§Ø³ÛŒØ¯Ú†Ø±Ø¨ ØªØ±Ø§Ù†Ø³'].forEach((fa,i)=>{
        const en=translations[fa];
        const unitLbl=i===0?'Ú©ÛŒÙ„ÙˆÚ©Ø§Ù„Ø±ÛŒ':'Ú¯Ø±Ù…';
        html+=`<tr class="${classes[i]}"><td>${fa}/${en}</td><td>${vals[i]} ${unitLbl}</td></tr>`;
      });
      html+=`</table>`;
      document.getElementById("resultContainer").innerHTML=html;
    }

    function saveAsPNG(){
      const name=document.getElementById("foodName").value.trim()||'table';
      html2canvas(document.getElementById("exportArea"),{backgroundColor:null,scale:2})
        .then(canvas=>{const link=document.createElement("a");link.href=canvas.toDataURL("image/png");link.download=`${name.replace(/\s+/g,'_')}.png`;link.click();});
    }
    function printTable(){window.print();}
    function clearInputs(){
      document.querySelectorAll("input").forEach(i=>i.value="");
      document.getElementById("foodType").value="Ø¬Ø§Ù…Ø¯";
      document.getElementById("servingCriterion").value="";
      updateServingUnits();
      document.getElementById("resultContainer").innerHTML="";
    }
    function exportExcel(){
      /* Ù…Ø´Ø§Ø¨Ù‡ Ù‚Ø¨Ù„ */
    }
    function toggleHelp(){
      const o=document.getElementById("helpOverlay");
      o.style.display=o.style.display==='flex'?'none':'flex';
    }
    window.addEventListener("DOMContentLoaded",()=>{
      updateServingUnits();
      setTimeout(()=>{document.getElementById("welcomeOverlay").style.display='none';},5000);
    });
    document.addEventListener("keydown",e=>{
      if(e.key==="Enter"){
        const inputs=Array.from(document.querySelectorAll("input, select"));
        const i=inputs.indexOf(document.activeElement);
        if(i>-1){e.preventDefault();i+1<inputs.length?inputs[i+1].focus():render();}
      }
    });
  </script>
</body>
</html>

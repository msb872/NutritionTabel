

<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title> ØªØ¹ÛŒÛŒÙ† Ú¯Ø±ÙˆÙ‡ Ø±Ù†Ú¯ÛŒ Ù…ÙˆØ§Ø¯ ØºØ°Ø§ÛŒÛŒ</title>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
<style>
header { background:#3D8632; color:#fff; padding:2px; border-radius:2px; text-align:center; margin-bottom:5px; }
body { font-family: Tahoma, sans-serif; background-color: #f9f9f9; direction: rtl; padding: 10px; position: relative; }
table { border-collapse: collapse; width: 100%; max-width: 500px; margin: 0 auto 20px; background-color: #fff; }
th, td { border: 1px solid #5300AD; padding: 2px 3px; text-align: center; font-size: 14px; }
th { background-color: #BEB567; }
input, select { width: 100%; padding: 6px; font-size: 15px; margin: 4px 0; box-sizing: border-box; text-align: center; font-weight: bold; line-height: 1.6; height: 36px; }
.green { background-color: #7AB52A; color: #256029; }
.orange { background-color: #FFCC00; color: #000; }
.red { background-color: #E00815; color: #FFF; }
.float-container { position: fixed; bottom: 30px; right: 20px; display: flex; flex-direction: column-reverse; gap: 8px; z-index: 100; }
.float-btn { background-color: #2563EB; color: #fff; border: none; border-radius: 50%; width: 56px; height: 56px; font-size: 24px; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; }
.float-btn:hover { background-color: #1E40AF; }
@media print { body * { visibility: hidden; } #exportArea, #exportArea * { visibility: visible; } #exportArea { position: absolute; top: 0; left: 0; width: 100%; } table, th, td { -webkit-print-color-adjust: exact; print-color-adjust: exact; } }

#welcomeOverlay { position: fixed; top:0; left:0; right:0; bottom:0; background: linear-gradient(115deg, #2163EB, #2CA7EC); display: flex; align-items: center; justify-content: center; z-index:200; }
#welcomeOverlay .box { background:#fff; padding:50px; border-radius:10px; text-align:center; max-width:600px; animation: fadeInOut 5s forwards; }
#welcomeOverlay .box h1 { margin-bottom:10px; font-family:'Dancing Script', cursive; font-size:22px; color:#000; line-height:1.3; }
#welcomeOverlay .author { font-size:18px; margin-bottom:15px; }
#welcomeOverlay .spinner { margin:0 auto 15px; width:40px; height:40px; border:4px solid #f3f3f3; border-top:4px solid #2563EB; border-radius:50%; animation: spin 1s linear infinite; }
#welcomeOverlay .copyright { font-size:14px; color:#666; margin-top:10px; }
@keyframes spin { 0%{transform:rotate(0deg);}100%{transform:rotate(360deg);} }
@keyframes fadeInOut { 0%{opacity:0;}10%{opacity:1;}90%{opacity:1;}100%{opacity:0;visibility:hidden;} }

#helpOverlay { position: fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 200; }
#helpOverlay .box { background: #fff; padding:20px; border-radius:6px; max-width:500px; text-align:right; line-height:1.6; position: relative; }
#helpOverlay .close-btn { position:absolute; top:8px; left:8px; background:#e53e3e; border:none; color:#fff; border-radius:50%; width:28px; height:28px; font-size:18px; cursor:pointer; }
#helpOverlay h2 { margin-top:0; font-size:20px; text-align:center; }
#helpOverlay ol { padding-right:16px; }
#helpOverlay ol li { margin-bottom:8px; }
#helpOverlay .contact, #helpOverlay .feedback { margin-top:12px; font-size:14px; }
#helpOverlay .contact strong { display:block; margin-bottom:4px; }
#helpOverlay .feedback ul { padding-right:16px; }
#helpOverlay .feedback ul li { margin-bottom:4px; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>

<header>
  <h2> Ù†Ø±Ù… Ø§ÙØ²Ø§Ø± ØªØ¹ÛŒÛŒÙ† Ú¯Ø±ÙˆÙ‡ Ø±Ù†Ú¯ÛŒ Ù…ÙˆØ§Ø¯ ØºØ°Ø§ÛŒÛŒ( Ù†Ø´Ø§Ù†Ú¯Ø± Ø±Ù†Ú¯ÛŒ) v1.01</h2>
</header>

<!-- Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ -->
<div id="welcomeOverlay">
<div class="box">
  <img src="https://www.1and1group.com/wp-content/uploads/2024/06/1and1group-logo.webp" alt="Logo" style="width:120px; border-radius:12px; margin-bottom:15px;">
  <h1>
    Ù†Ø±Ù… Ø§ÙØ²Ø§Ø± ØªØ¹ÛŒÛŒÙ† Ú¯Ø±ÙˆÙ‡ Ø±Ù†Ú¯ÛŒ Ù…ÙˆØ§Ø¯ ØºØ°Ø§ÛŒÛŒ
    <br>Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¢Ø®Ø±ÛŒÙ† ÙˆÛŒØ±Ø§ÛŒØ´ Ø¶ÙˆØ§Ø¨Ø· Ø¨Ø±Ú†Ø³Ø¨â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø³Ø§Ø²Ù…Ø§Ù† ØºØ°Ø§ Ùˆ Ø¯Ø§Ø±Ùˆ</br>
  </h1>
  <div class="author">Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡: Ù…ØµÛŒØ¨ Ø®Ø§Ù†ÛŒ â€“ Ú©Ø§Ø±Ø´Ù†Ø§Ø³ Ø¢Ø²Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ Ùˆ Ú©Ù†ØªØ±Ù„ Ú©ÛŒÙÛŒØª</div>
  <div class="spinner"></div>
  <div class="copyright">
    Â© 2025 Ø¢Ø²Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ Ùˆ Ú©Ù†ØªØ±Ù„ Ú©ÛŒÙÛŒØª ÙØ±Ø§ÙˆØ±Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØºØ°Ø§ÛŒÛŒ Ø¯Ø´Øª Ù…Ø±ØºØ§â€ŒØ¨ (ÛŒÚ© Ùˆ ÛŒÚ©). All rights reserved.
  </div>
</div>
</div>

<!-- ÙØ±Ù… ÙˆØ±ÙˆØ¯ÛŒ -->
<table>
<tr><th>Ù†Ø§Ù… Ù…Ø§Ø¯Ù‡ ØºØ°Ø§ÛŒÛŒ</th><td><input type="text" id="foodName" oninput="render()"></td></tr>
<tr><th>Ù†ÙˆØ¹ Ù…Ø§Ø¯Ù‡ ØºØ°Ø§ÛŒÛŒ</th><td>
<select id="foodType" onchange="updateServingUnits(); render()">
  <option value="Ø¬Ø§Ù…Ø¯">Ø¬Ø§Ù…Ø¯</option>
  <option value="Ù…Ø§ÛŒØ¹">Ù…Ø§ÛŒØ¹</option>
</select>
</td></tr>
<tr><th>Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø³Ù‡Ù…</th><td><input type="number" id="servingSize" oninput="render()"></td></tr>
<tr><th>ÙˆØ§Ø­Ø¯ Ø³Ù‡Ù…</th><td><select id="servingUnit" onchange="render()"></select></td></tr>
<tr><th>Ù…Ø¹ÛŒØ§Ø± Ø³Ù‡Ù…</th><td>
<input type="text" id="servingCriterion" list="servingCriteria" placeholder="Ø¬Ø³ØªØ¬Ùˆ ÛŒØ§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" oninput="render()" autocomplete="off">
<datalist id="servingCriteria">
  <option value="1 Ù‚Ø§Ø´Ù‚ Ú†Ø§ÛŒØ®ÙˆØ±ÛŒ"><option value="1 Ù‚Ø§Ø´Ù‚ ØºØ°Ø§Ø®ÙˆØ±ÛŒ"><option value="2 Ù‚Ø§Ø´Ù‚ ØºØ°Ø§Ø®ÙˆØ±ÛŒ"><option value="1 Ù‚Ø§Ø´Ù‚ Ù…Ø±Ø¨Ø§Ø®ÙˆØ±ÛŒ"><option value="2 Ù‚Ø§Ø´Ù‚ Ù…Ø±Ø¨Ø§Ø®ÙˆØ±ÛŒ"><option value="1 ÙÙ†Ø¬Ø§Ù†"><option value="1/2 ÙÙ†Ø¬Ø§Ù†"><option value="1/2 Ø¹Ø¯Ø¯"><option value="1 Ø¹Ø¯Ø¯"><option value="2 Ø¹Ø¯Ø¯"><option value="3 Ø¹Ø¯Ø¯"><option value="5 Ø¹Ø¯Ø¯"><option value="7 Ø¹Ø¯Ø¯"><option value="5 ØªÚ©Ù‡"><option value="10 Ø§Ø³Ù„Ø§ÛŒØ³"><option value="11 Ø§Ø³Ù„Ø§ÛŒØ³"><option value="12 Ø§Ø³Ù„Ø§ÛŒØ³"><option value="13 Ø§Ø³Ù„Ø§ÛŒØ³">
</datalist>
</td></tr>
<tr><th>Ø§Ù†Ø±Ú˜ÛŒ Ø¯Ø± 100 Ú¯Ø±Ù…</th><td><input type="number" id="energy100" oninput="render()"></td></tr>
<tr><th>Ù‚Ù†Ø¯ Ø¯Ø± 100 Ú¯Ø±Ù…</th><td><input type="number" id="sugar100" oninput="render()"></td></tr>
<tr><th>Ú†Ø±Ø¨ÛŒ Ø¯Ø± 100 Ú¯Ø±Ù…</th><td><input type="number" id="fat100" oninput="render()"></td></tr>
<tr><th>Ù†Ù…Ú© Ø¯Ø± 100 Ú¯Ø±Ù…</th><td><input type="number" id="salt100" oninput="render()"></td></tr>
<tr><th>Ø§Ø³ÛŒØ¯Ú†Ø±Ø¨ ØªØ±Ø§Ù†Ø³ Ø¯Ø± 100 Ú¯Ø±Ù…</th><td><input type="number" id="trans100" oninput="render()"></td></tr>
</table>

<!-- Ù†Ø§Ø­ÛŒÙ‡ Ø®Ø±ÙˆØ¬ÛŒ -->
<div id="exportArea"><div id="resultContainer"></div></div>

<!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ù†Ø§ÙˆØ± -->
<div class="float-container">
<button class="float-btn" title="Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡" onclick="toggleHelp()">â”</button>
<button class="float-btn" title="Ø±ÛŒØ³Øª Ø¯Ø§Ø¯Ù‡ Ù‡Ø§" onclick="clearInputs()">ğŸ”„</button>
<button class="float-btn" title="Ø°Ø®ÛŒØ±Ù‡ Excel" onclick="exportExcel()">ğŸ“Š</button>
<button class="float-btn" title="Ù¾Ø±ÛŒÙ†Øª Ø¬Ø¯ÙˆÙ„" onclick="printTable()">ğŸ–¨ï¸</button>
<button class="float-btn" title="Ø°Ø®ÛŒØ±Ù‡ ØªØµÙˆÛŒØ±" onclick="saveAsPNG()">ğŸ’¾</button>
</div>

<!-- Ù¾Ù†Ø¬Ø±Ù‡ Ø±Ø§Ù‡Ù†Ù…Ø§ -->
<div id="helpOverlay">
<div class="box">
  <button class="close-btn" onclick="toggleHelp()">Ã—</button>
  <img src="https://www.1and1group.com/wp-content/uploads/2024/06/1and1group-logo.webp" alt="Logo" style="width:100px; border-radius:10px; display:block; margin:0 auto 12px;">
  <h2>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ø± Ø¨Ø§ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±</h2>
  <ol>
    <li>Ù†Ø§Ù… Ù…Ø§Ø¯Ù‡ ØºØ°Ø§ÛŒÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</li>
    <li>Ù†ÙˆØ¹ (Ø¬Ø§Ù…Ø¯/Ù…Ø§ÛŒØ¹) Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ØªØ§ ÙˆØ§Ø­Ø¯ Ø³Ù‡Ù… Ø¨Ù‡â€ŒØ±ÙˆØ² Ø´ÙˆØ¯.</li>
    <li>Ø§Ù†Ø¯Ø§Ø²Ù‡ Ùˆ Ù…Ø¹ÛŒØ§Ø± Ø³Ù‡Ù… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</li>
    <li>Ù…Ù‚Ø§Ø¯ÛŒØ± Ø§Ù†Ø±Ú˜ÛŒØŒ Ù‚Ù†Ø¯ØŒ Ú†Ø±Ø¨ÛŒØŒ Ù†Ù…Ú© Ùˆ TFA Ø±Ø§ Ø¨Ø± Ø­Ø³Ø¨ 100 Ú¯Ø±Ù… ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</li>
    <li>Ø¨Ø§ Ø²Ø¯Ù† Enter Ø¨Ù‡ ÙÛŒÙ„Ø¯ Ø¨Ø¹Ø¯ÛŒ Ù…ÛŒâ€ŒØ±ÙˆÛŒØ¯.</li>
    <li>Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ø¯Ú©Ù…Ù‡ Â«ğŸ”„Â» Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯.</li>
    <li>Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ Excel Ø¯Ú©Ù…Ù‡ Â«ğŸ“ŠÂ» Ùˆ Ø¨Ø±Ø§ÛŒ Ù¾Ø±ÛŒÙ†Øª Â«ğŸ–¨ï¸Â» Ø±Ø§ ÙØ´Ø§Ø± Ø¯Ù‡ÛŒØ¯.</li>
    <li>Ø¨Ø¹Ø¯ Ø§Ø² Ø°Ø®ÛŒØ±Ù‡ ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„ØŒ Ø§Ø¨ØªØ¯Ø§ Ø±ÙˆÛŒ ÙØ§ÛŒÙ„ Ø±Ø§Ø³Øª Ú©Ù„ÛŒÚ© Ú©Ø±Ø¯Ù‡ Ùˆ ØªÛŒÚ© Ú¯Ø²ÛŒÙ†Ù‡ Unblock Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯.</li>
    <li>Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ PNG Ø¯Ú©Ù…Ù‡ Â«ğŸ’¾Â» Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</li>
  </ol>
  <div class="contact">
    <strong>Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡:</strong> Ù…ØµÛŒØ¨ Ø®Ø§Ù†ÛŒ<br>
    <strong>Mail:</strong>ğŸ“§ <a href="mailto:mosayeb872@gmail.com" style="color:#d35400;">mosayeb872@gmail.com</a>
    <strong>ØªÙ„ÙÙ†:</strong> 0917-320-6052
  </div>
</div>
</div>

<script>
// Ù‚ÙˆØ§Ø¹Ø¯ Ù¾Ø§ÛŒÙ‡ (Ø­Ø¯ Ø³Ø¨Ø²ØŒ Ø­Ø¯ Ù†Ø§Ø±Ù†Ø¬ÛŒ Ø¯Ø± 100 ÙˆØ§Ø­Ø¯ØŒ Ùˆ Â«Ø­Ø¯ Ù†Ø§Ø±Ù†Ø¬ÛŒÙ Ø³Ù‡Ù… Ø¨Ø²Ø±Ú¯Â»)
const rules = {
  Ø¬Ø§Ù…Ø¯: { fat:[3,17.5,21], sugar:[5,22.5,27],  salt:[0.3,1.5,1.8], trans:[0.5,2,2] },
  Ù…Ø§ÛŒØ¹: { fat:[1.5,8.75,10.5], sugar:[2.5,11.25,13.5], salt:[0.3,0.75,0.9], trans:[0.5,2,2] }
};
const translations = { 'Ø§Ù†Ø±Ú˜ÛŒ':'Energy','Ù‚Ù†Ø¯':'Sugar','Ú†Ø±Ø¨ÛŒ':'Fat','Ù†Ù…Ú©':'Salt','Ø§Ø³ÛŒØ¯Ú†Ø±Ø¨ ØªØ±Ø§Ù†Ø³':'TFA' };

function updateServingUnits(){
  const type = document.getElementById("foodType").value;
  const sel = document.getElementById("servingUnit");
  sel.innerHTML = "";
  const units = type==="Ø¬Ø§Ù…Ø¯"?["Ú¯Ø±Ù…"]:["Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±"];
  units.forEach(u=>{ const o=document.createElement("option"); o.value=u; o.textContent=u; sel.appendChild(o); });
}

/* ØªØ§Ø¨Ø¹ Ø±Ù†Ú¯â€ŒØ¯Ù‡ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù‚ÙˆØ§Ù†ÛŒÙ† Ø´Ù…Ø§
   - Ø§Ú¯Ø± Ø³Ù‡Ù… <= Ù¾Ø§ÛŒÙ‡ (100g Ø¨Ø±Ø§ÛŒ Ø¬Ø§Ù…Ø¯ | 150ml Ø¨Ø±Ø§ÛŒ Ù…Ø§ÛŒØ¹): Ø§Ø² [g, o] Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
   - Ø§Ú¯Ø± Ø³Ù‡Ù… > Ù¾Ø§ÛŒÙ‡: Ø§Ø² [g, max] Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
   - g: Ø¢Ø³ØªØ§Ù†Ù‡ Ø³Ø¨Ø² | o: Ø¢Ø³ØªØ§Ù†Ù‡ Ù†Ø§Ø±Ù†Ø¬ÛŒ Ø¯Ø± 100 ÙˆØ§Ø­Ø¯ | max: Ø¢Ø³ØªØ§Ù†Ù‡ Ù†Ø§Ø±Ù†Ø¬ÛŒ Ø¯Ø± Ø³Ù‡Ù… Ø¨Ø²Ø±Ú¯
*/
function getColor(val, size, [g, o, max]) {
  const type = document.getElementById("foodType").value;
  const baseLimit = (type === "Ù…Ø§ÛŒØ¹") ? 150 : 100;

  const v = parseFloat(val);
  const s = parseFloat(size);
  if (isNaN(v)) return "";

  // Ø³Ù‡Ù… Ø¨Ø²Ø±Ú¯â€ŒØªØ± Ø§Ø² Ø­Ø¯ Ù¾Ø§ÛŒÙ‡ØŸ
  if (!isNaN(s) && s > baseLimit) {
    if (v <= g) return "green";
    if (v > g && v <= max) return "orange";
    if (v > max) return "red";
  } else {
    // Ø³Ù‡Ù… ØªØ§ Ø­Ø¯ Ù¾Ø§ÛŒÙ‡ (ÛŒØ§ Ø®Ø§Ù„ÛŒ/ØµÙØ±)
    if (v <= g) return "green";
    if (v > g && v <= o) return "orange";
    if (v > o) return "red";
  }
  return "";
}

function render(){
  const name = document.getElementById("foodName").value.trim();
  const size = +document.getElementById("servingSize").value || 0;
  if(!name || size<=0){ document.getElementById("resultContainer").innerHTML=""; return; }
  const type = document.getElementById("foodType").value;
  const unit = document.getElementById("servingUnit").value;
  const crit = document.getElementById("servingCriterion").value;
  const e100 = document.getElementById("energy100").value;
  const s100 = document.getElementById("sugar100").value;
  const f100 = document.getElementById("fat100").value;
  const sa100= document.getElementById("salt100").value;
  const t100 = document.getElementById("trans100").value;

  const vals = [
    (e100*size/100).toFixed(2),
    (s100*size/100).toFixed(2),
    (f100*size/100).toFixed(2),
    (sa100*size/100).toFixed(2),
    (t100*size/100).toFixed(2)
  ];
  const keysFa = ['Ø§Ù†Ø±Ú˜ÛŒ','Ù‚Ù†Ø¯','Ú†Ø±Ø¨ÛŒ','Ù†Ù…Ú©','Ø§Ø³ÛŒØ¯Ú†Ø±Ø¨ ØªØ±Ø§Ù†Ø³'];

  const raw = { sugar:s100, fat:f100, salt:sa100, trans:t100 };

  const classes = [
    "", // Ø§Ù†Ø±Ú˜ÛŒ Ø±Ù†Ú¯ Ù†Ø¯Ø§Ø±Ø¯
    raw.sugar!=="" ? getColor(s100,size,rules[type].sugar) : "",
    raw.fat!==""   ? getColor(f100,size,rules[type].fat)   : "",
    raw.salt!==""  ? getColor(sa100,size,rules[type].salt) : "",
    raw.trans!=="" ? getColor(t100,size,rules[type].trans) : ""
  ];

  const shareLabel = crit?`${crit} ${name} â€“ ${size} ${unit}`:`${name} â€“ ${size} ${unit}`;

  let html = `<table><tr><th>Ù…Ø§Ø¯Ù‡ Ù…ØºØ°ÛŒ / Nutrient</th><th>Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø³Ù‡Ù… (${shareLabel})</th></tr>`;
  keysFa.forEach((fa,i)=>{
    const en = translations[fa];
    const unitLbl = i===0?'Ú©ÛŒÙ„ÙˆÚ©Ø§Ù„Ø±ÛŒ':'Ú¯Ø±Ù…';
    html += `<tr class="${classes[i]}"><td>${fa}/${en}</td><td>${vals[i]} ${unitLbl}</td></tr>`;
  });
  html += `</table>`;
  document.getElementById("resultContainer").innerHTML = html;
}

function saveAsPNG(){
  const name = document.getElementById("foodName").value.trim()||'table';
  html2canvas(document.getElementById("exportArea"), { backgroundColor:null, scale:2 }).then(canvas=>{
    const link=document.createElement("a");
    link.href=canvas.toDataURL("image/png");
    link.download=`${name.replace(/\s+/g,'_')}.png`;
    link.click();
  });
}

function printTable(){ window.print(); }

function clearInputs(){
  document.querySelectorAll("input").forEach(i=>i.value="");
  document.getElementById("foodType").value="Ø¬Ø§Ù…Ø¯";
  document.getElementById("servingCriterion").value="";
  updateServingUnits();
  document.getElementById("resultContainer").innerHTML="";
}

function exportExcel() {
  const name = document.getElementById("foodName").value.trim() || 'table';
  const type = document.getElementById("foodType").value;
  const size = document.getElementById("servingSize").value;
  const unit = document.getElementById("servingUnit").value;
  const crit = document.getElementById("servingCriterion").value;
  const e100 = document.getElementById("energy100").value;
  const s100 = document.getElementById("sugar100").value;
  const f100 = document.getElementById("fat100").value;
  const sa100= document.getElementById("salt100").value; 
  const t100 = document.getElementById("trans100").value;

  let excel = `<html xmlns:o="urn:schemas-microsoft-com:office:office"
    xmlns:x="urn:schemas-microsoft-com:office:excel">
    <head><meta charset="utf-8"></head><body>`;
  excel += `<table><tr><th colspan="2">Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ±ÙˆØ¯ÛŒ</th></tr>`;
  excel += `<tr><td>Ù†Ø§Ù… Ù…Ø§Ø¯Ù‡ ØºØ°Ø§ÛŒÛŒ</td><td>${name}</td></tr>`;
  excel += `<tr><td>Ù†ÙˆØ¹</td><td>${type}</td></tr>`;
  excel += `<tr><td>Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø³Ù‡Ù…</td><td>${size} ${unit}</td></tr>`;
  excel += `<tr><td>Ù…Ø¹ÛŒØ§Ø± Ø³Ù‡Ù…</td><td>${crit}</td></tr>`;
  excel += `<tr><td>Ø§Ù†Ø±Ú˜ÛŒ</td><td>${e100} (100g)</td></tr>`;
  excel += `<tr><td>Ù‚Ù†Ø¯</td><td>${s100} (100g)</td></tr>`;
  excel += `<tr><td>Ú†Ø±Ø¨ÛŒ</td><td>${f100} (100g)</td></tr>`;
  excel += `<tr><td>Ù†Ù…Ú©</td><td>${sa100} (100g)</td></tr>`;
  excel += `<tr><td>TFA</td><td>${t100} (100g)</td></tr>`;

  excel += `<tr><th colspan="2">Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ø¢Ø³ØªØ§Ù†Ù‡</th></tr>`;
  ['Ø¬Ø§Ù…Ø¯','Ù…Ø§ÛŒØ¹'].forEach(key => {
    const base = (key==='Ù…Ø§ÛŒØ¹')?'150 Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±':'100 Ú¯Ø±Ù…';
    excel += `<tr><th colspan="2">${key}</th></tr>`;
    ['sugar','fat','salt','trans'].forEach(n => {
      const [g,o,max] = rules[key][n];
      const label = {'sugar':'Ù‚Ù†Ø¯','fat':'Ú†Ø±Ø¨ÛŒ','salt':'Ù†Ù…Ú©','trans':'TFA'}[n];
      excel += `<tr><td>${label}</td><td>Ø³Ø¨Ø² â‰¤ ${g} (Ø¯Ø± 100 ÙˆØ§Ø­Ø¯) | Ù†Ø§Ø±Ù†Ø¬ÛŒ â‰¤ ${o} (Ø¯Ø± 100 ÙˆØ§Ø­Ø¯) | Ø¯Ø± Ø³Ù‡Ù… &gt; ${base}: Ù†Ø§Ø±Ù†Ø¬ÛŒ â‰¤ ${max}</td></tr>`;
    });
  });
  excel += `</table></body></html>`;

  const blob = new Blob([excel], { type:'application/vnd.ms-excel' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = `${name.replace(/\s+/g,'_')}.xls`;
  link.click();
}

function toggleHelp(){
  const overlay = document.getElementById("helpOverlay");
  overlay.style.display = overlay.style.display==='flex'?'none':'flex';
}

window.addEventListener("DOMContentLoaded",()=>{
  updateServingUnits();
  setTimeout(()=>{document.getElementById("welcomeOverlay").style.display='none';},5000);
});
</script>

</body>
</html>

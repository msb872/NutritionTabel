<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¬Ø¯ÙˆÙ„ Ø±Ù†Ú¯ÛŒ Ù…ÙˆØ§Ø¯ ØºØ°Ø§ÛŒÛŒ</title>

  <!-- Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ -->
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: Tahoma, sans-serif;
      background-color: #f9f9f9;
      direction: rtl;
      padding: 20px;
      position: relative;
    }

    table {
      border-collapse: collapse;
      width: 160%;
      max-width: 500px;
      margin: 0 auto 30px;
      background-color: #fff;
    }

    th, td {
      border: 2px solid #5300AD;
      padding: 2px;
      text-align: center;
      font-size: 17px;
    }

    th {
      background-color: #BEB567;
    }

    input, select {
      width: 90%;
      padding: 6px;
      font-size: 17px;
      margin: 4px 0;
    }

    .green { background-color: #00FF00; color: #256029; }
    .orange { background-color: #FFAF1C; color: #000; }
    .red { background-color: #FF0000; color: #FFF; }

    .float-container {
      position: fixed;
      bottom: 30px;
      right: 20px;
      display: flex;
      flex-direction: column-reverse;
      gap: 8px;
      z-index: 100;
    }
    .float-btn {
      background-color: #2563EB;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .float-btn:hover {
      background-color: #1E40AF;
    }

    @media print {
      body * { visibility: hidden; }
      #exportArea, #exportArea * { visibility: visible; }
      #exportArea {
        position: absolute;
        top: 0; left: 0;
        width: 100%;
      }
      table, th, td {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
    }

    /* Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ */
    #welcomeOverlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(115deg, #2163EB, #2CA7EC);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
    }
    #welcomeOverlay .box {
      background: #ffff;
      padding: 50px 50px;
      border-radius: 10px;
      text-align: center;
      max-width: 600px;
      animation: fadeInOut 5s forwards;
    }
    #welcomeOverlay .box h1 {
      margin: 0 0 10px;
      font-family: 'Dancing Script', cursive;
      font-size: 22px;
      color: #000000;
      line-height: 1.3;
    }
    #welcomeOverlay .box .author {
      font-size: 18px;
      margin-bottom: 15px;
    }
    #welcomeOverlay .box .spinner {
      margin: 0 auto 15px;
      width: 40px; height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #2563EB;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    #welcomeOverlay .box .copyright {
      font-size: 14px;
      color: #666;
      margin-top: 10px;
    }
    @keyframes spin {
      0%   { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes fadeInOut {
      0%   { opacity: 0; }
      10%  { opacity: 1; }
      90%  { opacity: 1; }
      100% { opacity: 0; display: none; }
    }

    /* Ø±Ø§Ù‡Ù†Ù…Ø§ */
    #helpOverlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 200;
    }
    #helpOverlay .box {
      background: #fff;
      padding: 20px;
      border-radius: 6px;
      max-width: 500px;
      text-align: right;
      line-height: 1.6;
      position: relative;
    }
    #helpOverlay .close-btn {
      position: absolute;
      top: 8px; left: 8px;
      background: #e53e3e;
      border: none;
      color: #fff;
      border-radius: 50%;
      width: 28px; height: 28px;
      font-size: 18px;
      cursor: pointer;
    }
    #helpOverlay h2 {
      margin-top: 0;
      font-size: 20px;
      text-align: center;
    }
    #helpOverlay ol {
      padding-right: 16px;
    }
    #helpOverlay ol li {
      margin-bottom: 8px;
    }
    #helpOverlay .contact, 
    #helpOverlay .feedback {
      margin-top: 12px;
      font-size: 14px;
    }
    #helpOverlay .contact strong {
      display: block;
      margin-bottom: 4px;
    }
    #helpOverlay .feedback ul {
      padding-right: 16px;
    }
    #helpOverlay .feedback ul li {
      margin-bottom: 4px;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>

  <!-- Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ -->
  <div id="welcomeOverlay">
    <div class="box">
      <h1>Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¬Ø¯ÙˆÙ„ Ø±Ù†Ú¯ÛŒ Ù…ÙˆØ§Ø¯ ØºØ°Ø§ÛŒÛŒ<br>
        Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¢Ø®Ø±ÛŒÙ† ÙˆÛŒØ±Ø§ÛŒØ´ Ø¶ÙˆØ§Ø¨Ø· Ø¨Ø±Ú†Ø³Ø¨â€ŒÚ¯Ø°Ø§Ø±ÛŒ<br>
        Ø§Ø¯Ø§Ø±Ù‡ Ù†Ø¸Ø§Ø±Øª Ø¨Ø± Ù…ÙˆØ§Ø¯ ØºØ°Ø§ÛŒÛŒ
      </h1>
      <div class="author">Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡: Ù…ØµÛŒØ¨ Ø®Ø§Ù†ÛŒ â€“ Ú©Ø§Ø±Ø´Ù†Ø§Ø³ Ú©Ù†ØªØ±Ù„ Ú©ÛŒÙÛŒØª</div>
      <div class="spinner"></div>
      <div class="copyright">
        Â© 2025 Ø¢Ø²Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡ Ùˆ Ú©Ù†ØªØ±Ù„ Ú©ÛŒÙÛŒØª Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ ÛŒÚ© Ùˆ ÛŒÚ© Ø¯Ø´Øª Ù…Ø±ØºØ§Ø¨. All rights reserved.
      </div>
    </div>
  </div>

  <!-- ÙØ±Ù… ÙˆØ±ÙˆØ¯ÛŒ -->
  <table>
    <tr><th>Ù†Ø§Ù… Ù…Ø§Ø¯Ù‡ ØºØ°Ø§ÛŒÛŒ</th>
      <td><input type="text" id="foodName" oninput="render()"></td>
    </tr>
    <tr><th>Ù†ÙˆØ¹ Ù…Ø§Ø¯Ù‡ ØºØ°Ø§ÛŒÛŒ</th>
      <td>
        <select id="foodType" onchange="updateServingUnits(); render()">
          <option value="Ø¬Ø§Ù…Ø¯">Ø¬Ø§Ù…Ø¯</option>
          <option value="Ù…Ø§ÛŒØ¹">Ù…Ø§ÛŒØ¹</option>
        </select>
      </td>
    </tr>
    <tr><th>Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø³Ù‡Ù…</th>
      <td><input type="number" id="servingSize" oninput="render()"></td>
    </tr>
    <tr><th>ÙˆØ§Ø­Ø¯ Ø³Ù‡Ù…</th>
      <td><select id="servingUnit" onchange="render()"></select></td>
    </tr>
    <tr><th>Ù…Ø¹ÛŒØ§Ø± Ø³Ù‡Ù…</th>
      <td>
        <input list="servingCriteria" id="servingCriterion" oninput="render()">
        <datalist id="servingCriteria">
          <option value="1 Ù‚Ø§Ø´Ù‚ Ú†Ø§ÛŒØ®ÙˆØ±ÛŒ"><option value="1 Ù‚Ø§Ø´Ù‚ ØºØ°Ø§Ø®ÙˆØ±ÛŒ"><option value="2 Ù‚Ø§Ø´Ù‚ ØºØ°Ø§Ø®ÙˆØ±ÛŒ">
          <option value="1 Ù‚Ø§Ø´Ù‚ Ù…Ø±Ø¨Ø§Ø®ÙˆØ±ÛŒ"><option value="2 Ù‚Ø§Ø´Ù‚ Ù…Ø±Ø¨Ø§Ø®ÙˆØ±ÛŒ">
          <option value="1 Ù‚Ø§Ø´Ù‚ Ú†Ø§ÛŒØ®ÙˆØ±ÛŒ"><option value="1 ÙÙ†Ø¬Ø§Ù†"><option value="1/2 ÙÙ†Ø¬Ø§Ù†">
          <option value="1 Ø¹Ø¯Ø¯"><option value="2 Ø¹Ø¯Ø¯">
          <option value="3 Ø¹Ø¯Ø¯"><option value="5 Ø¹Ø¯Ø¯"><option value="7 Ø¹Ø¯Ø¯"><option value="5 ØªÚ©Ù‡">
          <option value="10 Ø§Ø³Ù„Ø§ÛŒØ³"><option value="11 Ø§Ø³Ù„Ø§ÛŒØ³"><option value="12 Ø§Ø³Ù„Ø§ÛŒØ³"><option value="13 Ø§Ø³Ù„Ø§ÛŒØ³">
        </datalist>
      </td>
    </tr>
    <tr><th>Ø§Ù†Ø±Ú˜ÛŒ Ø¯Ø± 100 Ú¯Ø±Ù…</th>
      <td><input type="number" id="energy100" oninput="render()"></td>
    </tr>
    <tr><th>Ù‚Ù†Ø¯ Ø¯Ø± 100 Ú¯Ø±Ù…</th>
      <td><input type="number" id="sugar100" oninput="render()"></td>
    </tr>
    <tr><th>Ú†Ø±Ø¨ÛŒ Ø¯Ø± 100 Ú¯Ø±Ù…</th>
      <td><input type="number" id="fat100" oninput="render()"></td>
    </tr>
    <tr><th>Ù†Ù…Ú© Ø¯Ø± 100 Ú¯Ø±Ù…</th>
      <td><input type="number" id="salt100" oninput="render()"></td>
    </tr>
    <tr><th>Ø§Ø³ÛŒØ¯Ú†Ø±Ø¨ ØªØ±Ø§Ù†Ø³ Ø¯Ø± 100 Ú¯Ø±Ù…</th>
      <td><input type="number" id="trans100" oninput="render()"></td>
    </tr>
  </table>

  <!-- Ù†Ø§Ø­ÛŒÙ‡ Ø®Ø±ÙˆØ¬ÛŒ -->
  <div id="exportArea">
    <div id="resultContainer"></div>
  </div>

  <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ù†Ø§ÙˆØ± -->
  <div class="float-container">
    <button class="float-btn" title="Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡" onclick="toggleHelp()">â”</button>
    <button class="float-btn" title="Ø±ÛŒØ³Øª Ø¯Ø§Ø¯Ù‡ Ù‡Ø§" onclick="clearInputs()">ğŸ”„</button>
    <button class="float-btn" title="Ø°Ø®ÛŒØ±Ù‡ Excel" onclick="exportExcel()">ğŸ“Š</button>
    <button class="float-btn" title="Ù¾Ø±ÛŒÙ†Øª Ø¬Ø¯ÙˆÙ„" onclick="printTable()">ğŸ–¨ï¸</button>
    <button class="float-btn" title="Ø°Ø®ÛŒØ±Ù‡ ØªØµÙˆÛŒØ±" onclick="saveAsJPG()">ğŸ’¾</button>
  </div>

  <!-- Ù¾Ù†Ø¬Ø±Ù‡ Ø±Ø§Ù‡Ù†Ù…Ø§ -->
  <div id="helpOverlay">
    <div class="box">
      <button class="close-btn" onclick="toggleHelp()">Ã—</button>
      <h2>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ø± Ø¨Ø§ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±</h2>
      <ol>
        <li>Ù†Ø§Ù… Ù…Ø§Ø¯Ù‡ ØºØ°Ø§ÛŒÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</li>
        <li>Ù†ÙˆØ¹ (Ø¬Ø§Ù…Ø¯/Ù…Ø§ÛŒØ¹) Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ØªØ§ ÙˆØ§Ø­Ø¯Ù‡Ø§ÛŒ Ø³Ù‡Ù… Ø¨Ù‡â€ŒØ±ÙˆØ² Ø´ÙˆÙ†Ø¯.</li>
        <li>Ø§Ù†Ø¯Ø§Ø²Ù‡ Ùˆ Ù…Ø¹ÛŒØ§Ø± Ø³Ù‡Ù… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</li>
        <li>Ù…Ù‚Ø§Ø¯ÛŒØ± Ø§Ù†Ø±Ú˜ÛŒØŒ Ù‚Ù†Ø¯ØŒ Ú†Ø±Ø¨ÛŒØŒ Ù†Ù…Ú© Ùˆ TFA Ø±Ø§ Ø¨Ø± Ø­Ø³Ø¨ 100 Ú¯Ø±Ù… ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</li>
        <li>Ø¨Ø§ ÙØ´Ø±Ø¯Ù† Enter Ø¨Ù‡ ÙÛŒÙ„Ø¯ Ø¨Ø¹Ø¯ÛŒ Ù…Ù†ØªÙ‚Ù„ Ø´ÙˆÛŒØ¯.</li>
        <li>Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø¯Ú©Ù…Ù‡ Â«ğŸ”„Â» Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯.</li>
        <li>Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ Excel Ø¨Ø§ Ø³Ø§Ø®ØªØ§Ø± ÙˆØ±ÙˆØ¯ÛŒ Ùˆ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ Ø¯Ú©Ù…Ù‡ Â«ğŸ“ŠÂ» Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</li>
        <li>Ø¨Ø±Ø§ÛŒ Ù¾Ø±ÛŒÙ†Øª Ø±Ù†Ú¯ÛŒ Ø¬Ø¯ÙˆÙ„ Â«ğŸ–¨ï¸Â» Ùˆ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ JPG Â«ğŸ’¾Â» Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯.</li>
      </ol>
      <div class="contact">
        <strong>Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡:</strong> Ù…ØµÛŒØ¨ Ø®Ø§Ù†ÛŒ<br>
        <strong>Ø§ÛŒÙ…ÛŒÙ„:</strong> mosayeb872@gmail.com<br>
        <strong>ØªÙ„ÙÙ†:</strong> 0917-320-6052
      </div>
      <div class="feedback">
        <strong>Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ùˆ Ø§Ù†ØªÙ‚Ø§Ø¯Ø§Øª:</strong>
        <ul>
          <li>Ù„Ø·ÙØ§Ù‹ Ù†Ø¸Ø±Ø§Øª Ùˆ Ù…Ø´Ú©Ù„Ø§Øª Ø±Ø§ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ø§ÛŒÙ…ÛŒÙ„ Ø¨Ø§Ù„Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.</li>
          <li>Ø¨Ø±Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ø¨Ø§Ú¯â€ŒÙ‡Ø§ Ùˆ Ø¯Ø±Ø®ÙˆØ§Ø³Øª ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø®ÙˆØ´Ø­Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆÛŒÙ… Ù‡Ù…Ú©Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯.</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    const rules = {
      Ø¬Ø§Ù…Ø¯: { fat:[3,17.5], sugar:[5,22.5], salt:[0.3,1.5], trans:[0.5,2] },
      Ù…Ø§ÛŒØ¹:{ fat:[1.5,8.75], sugar:[2.5,11.25], salt:[0.3,0.75], trans:[0.5,2] }
    };
    const translations = {
      'Ø§Ù†Ø±Ú˜ÛŒ':'Energy','Ù‚Ù†Ø¯':'Sugar','Ú†Ø±Ø¨ÛŒ':'Fat',
      'Ù†Ù…Ú©':'Salt','Ø§Ø³ÛŒØ¯Ú†Ø±Ø¨ ØªØ±Ø§Ù†Ø³':'TFA'
    };

    function updateServingUnits() {
      const type = document.getElementById("foodType").value;
      const sel  = document.getElementById("servingUnit");
      sel.innerHTML = "";
      const units = type==="Ø¬Ø§Ù…Ø¯"
        ? ["Ú¯Ø±Ù…","Ø¹Ø¯Ø¯","ØªÚ©Ù‡","Ø§Ø³Ù„Ø§ÛŒØ³"]
        : ["Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±","Ù‚Ø§Ø´Ù‚ ØºØ°Ø§Ø®ÙˆØ±ÛŒ","ÙÙ†Ø¬Ø§Ù†"];
      units.forEach(u=>{
        const o=document.createElement("option");
        o.value=u; o.textContent=u;
        sel.appendChild(o);
      });
    }

    function getColor(val, size, [g100,o100]) {
      if(size===0) return "";
      if(val===0) return "green";
      const gMax=g100*size/100, oMax=o100*size/100;
      if(val<=gMax) return "green";
      if(val<=oMax) return "orange";
      return "red";
    }

    function render() {
      const name=document.getElementById("foodName").value.trim();
      const size=+document.getElementById("servingSize").value||0;
      if(!name||size<=0){
        document.getElementById("resultContainer").innerHTML="";
        return;
      }
      const type=document.getElementById("foodType").value;
      const unit=document.getElementById("servingUnit").value;
      const crit=document.getElementById("servingCriterion").value;
      const e100=+document.getElementById("energy100").value||0;
      const s100=+document.getElementById("sugar100").value||0;
      const f100=+document.getElementById("fat100").value||0;
      const sa100=+document.getElementById("salt100").value||0;
      const t100=+document.getElementById("trans100").value||0;

      const vals=[
        (e100*size/100).toFixed(2),
        +(s100*size/100).toFixed(2),
        +(f100*size/100).toFixed(2),
        +(sa100*size/100).toFixed(2),
        +(t100*size/100).toFixed(2)
      ];
      const keysFa=['Ø§Ù†Ø±Ú˜ÛŒ','Ù‚Ù†Ø¯','Ú†Ø±Ø¨ÛŒ','Ù†Ù…Ú©','Ø§Ø³ÛŒØ¯Ú†Ø±Ø¨ ØªØ±Ø§Ù†Ø³'];
      const classes=[
        "", getColor(vals[1],size,rules[type].sugar),
           getColor(vals[2],size,rules[type].fat),
           getColor(vals[3],size,rules[type].salt),
           getColor(vals[4],size,rules[type].trans)
      ];
      const shareLabel=crit
        ? `${crit} ${name} â€“ ${size} ${unit}`
        : `${name} â€“ ${size} ${unit}`;

      let html=`<table>
        <tr><th>Ù…Ø§Ø¯Ù‡ Ù…ØºØ°ÛŒ / Nutrient</th><th>Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø³Ù‡Ù… (${shareLabel})</th></tr>`;
      keysFa.forEach((fa,i)=>{
        const en=translations[fa];
        const unitLbl=i===0?'Ú©ÛŒÙ„ÙˆÚ©Ø§Ù„Ø±ÛŒ':'Ú¯Ø±Ù…';
        html+=`<tr class="${classes[i]}"><td>${fa}/${en}</td>
               <td>${vals[i]} ${unitLbl}</td></tr>`;
      });
      html+="</table>";
      document.getElementById("resultContainer").innerHTML=html;
    }

    function saveAsJPG() {
      const name=document.getElementById("foodName").value.trim()||'table';
      html2canvas(document.getElementById("exportArea"),{backgroundColor:'#fff',scale:2})
        .then(canvas=>{
          const link=document.createElement("a");
          link.href=canvas.toDataURL("image/jpeg",0.9);
          link.download=`${name.replace(/\s+/g,'_')}.jpg`;
          link.click();
        });
    }

    function printTable(){ window.print(); }

    function clearInputs(){
      document.querySelectorAll("input").forEach(i=>i.value="");
      document.getElementById("foodType").value="Ø¬Ø§Ù…Ø¯";
      updateServingUnits(); render();
    }

    function exportExcel(){
      const name=document.getElementById("foodName").value.trim()||'table';
      const type=document.getElementById("foodType").value;
      const size=document.getElementById("servingSize").value;
      const unit=document.getElementById("servingUnit").value;
      const crit=document.getElementById("servingCriterion").value;
      const e100=document.getElementById("energy100").value;
      const s100=document.getElementById("sugar100").value;
      const f100=document.getElementById("fat100").value;
      const sa100=document.getElementById("salt100").value;
      const t100=document.getElementById("trans100").value;

      let excel=`<html xmlns:o="urn:schemas-microsoft-com:office:office"
        xmlns:x="urn:schemas-microsoft-com:office:excel"><head><meta charset="utf-8"></head><body>`;
      excel+=`<table><tr><th colspan="2">Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ±ÙˆØ¯ÛŒ</th></tr>`;
      excel+=`<tr><td>Ù†Ø§Ù… Ù…Ø§Ø¯Ù‡ ØºØ°Ø§ÛŒÛŒ</td><td>${name}</td></tr>`;
      excel+=`<tr><td>Ù†ÙˆØ¹</td><td>${type}</td></tr>`;
      excel+=`<tr><td>Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø³Ù‡Ù…</td><td>${size} ${unit}</td></tr>`;
      excel+=`<tr><td>Ù…Ø¹ÛŒØ§Ø± Ø³Ù‡Ù…</td><td>${crit}</td></tr>`;
      excel+=`<tr><td>Ø§Ù†Ø±Ú˜ÛŒ</td><td>${e100} (100g)</td></tr>`;
      excel+=`<tr><td>Ù‚Ù†Ø¯</td><td>${s100} (100g)</td></tr>`;
      excel+=`<tr><td>Ú†Ø±Ø¨ÛŒ</td><td>${f100} (100g)</td></tr>`;
      excel+=`<tr><td>Ù†Ù…Ú©</td><td>${sa100} (100g)</td></tr>`;
      excel+=`<tr><td>TFA</td><td>${t100} (100g)</td></tr>`;
      excel+=`<tr><th colspan="2">Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ø¢Ø³ØªØ§Ù†Ù‡ (100g)</th></tr>`;
      ['Ø¬Ø§Ù…Ø¯','Ù…Ø§ÛŒØ¹'].forEach(key=>{
        excel+=`<tr><th colspan="2">${key}</th></tr>`;
        ['sugar','fat','salt','trans'].forEach(n=>{
          const [g,o]=rules[key][n];
          const label={'sugar':'Ù‚Ù†Ø¯','fat':'Ú†Ø±Ø¨ÛŒ','salt':'Ù†Ù…Ú©','trans':'TFA'}[n];
          excel+=`<tr><td>${label}</td><td>Ø³Ø§Ù„Ù… â‰¤${g}, Ù…ØªÙˆØ³Ø· â‰¤${o}</td></tr>`;
        });
      });
      excel+=`</table></body></html>`;

      const blob=new Blob([excel],{type:'application/vnd.ms-excel'});
      const link=document.createElement('a');
      link.href=URL.createObjectURL(blob);
      link.download=`${name.replace(/\s+/g,'_')}.xls`;
      link.click();
    }

    function toggleHelp(){
      const h=document.getElementById("helpOverlay");
      h.style.display = h.style.display==='flex'?'none':'flex';
    }

    window.onload = ()=>{
      updateServingUnits(); render();
      setTimeout(()=> {
        document.getElementById("welcomeOverlay").style.display='none';
      }, 5000);
      const fields=Array.from(document.querySelectorAll("input, select"));
      fields.forEach((f,i)=> {
        f.addEventListener("keydown", e=>{
          if(e.key==='Enter'){
            e.preventDefault();
            fields[i+1]?.focus();
          }
        });
      });
    };
  </script>
</body>
</html>
